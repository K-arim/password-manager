<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Password Manager — Simple Encrypted Vault</title>
  <meta name="description" content="A simple, attractive offline encrypted password manager using Web Crypto.">
  <style>
    /* Clean modern hero + card UI */
    :root{
      --bg1: #081129;
      --bg2: #0f3d91;
      --card: #ffffff;
      --accent: #1d9bf0;
      --muted: #6b7280;
      --glass: rgba(255,255,255,0.06);
      --radius: 14px;
    }
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
    body{
      background: linear-gradient(180deg,var(--bg1),var(--bg2));
      display:flex;align-items:center;justify-content:center;padding:28px;
      color:#0b1220;
    }
    .wrap{width:100%;max-width:1100px;display:grid;grid-template-columns:1fr 420px;gap:28px;align-items:start}
    @media (max-width:980px){ .wrap{grid-template-columns:1fr; padding:12px} }
    .hero{
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border-radius: var(--radius);
      padding:36px;
      color:#fff;
      box-shadow: 0 10px 40px rgba(2,6,23,0.45);
      border: 1px solid rgba(255,255,255,0.06);
    }
    .hero h1{margin:0;font-size:2.1rem;line-height:1.02}
    .hero p.lead{margin:12px 0 0 0;color:#dbeafe;opacity:0.95;font-size:1.05rem}
    .features{display:flex;gap:12px;margin-top:18px;flex-wrap:wrap}
    .chip{background:var(--glass);padding:10px 12px;border-radius:10px;font-weight:600;color:#dbeafe}
    .card{
      background:var(--card);
      border-radius:14px;
      padding:18px;
      box-shadow: 0 8px 30px rgba(2,6,23,0.16);
      border: 1px solid rgba(12,18,35,0.06);
    }
    label{display:block;font-size:.9rem;color:var(--muted);margin-top:8px}
    input[type="text"], input[type="password"]{
      width:100%;padding:12px;border-radius:10px;border:1px solid #e6eefc;margin-top:8px;font-size:15px;box-sizing:border-box;
      background: #fbfdff;
    }
    .row{display:flex;gap:8px;margin-top:12px}
    .btn{background:var(--accent);border:0;color:white;padding:12px;border-radius:10px;font-weight:700;cursor:pointer;flex:1}
    .btn.ghost{background:#f3f7ff;color:var(--accent);border:1px solid #e6f0ff;font-weight:700}
    .small{font-size:.88rem;color:var(--muted)}
    .list{margin-top:14px;max-height:360px;overflow:auto}
    .entry{background:#f8fafc;border:1px solid #eef3fb;padding:12px;border-radius:10px;margin-bottom:12px}
    .entry b{display:block}
    .entry .meta{display:flex;gap:8px;margin-top:8px}
    .btn-sm{padding:8px 10px;border-radius:8px;border:0;background:#eef6ff;color:#0b4db1;cursor:pointer;font-weight:700}
    .btn-danger{background:#fee2e2;color:#991b1b}
    footer{margin-top:18px;color:rgba(255,255,255,0.6);font-size:.86rem;text-align:center}
    .status{font-size:.9rem;color:var(--muted)}
    .hero-note{margin-top:14px;color:rgba(255,255,255,0.85);font-size:.95rem}
  </style>
</head>
<body>
  <div class="wrap" role="main">
    <section class="hero" aria-labelledby="title">
      <h1 id="title">Password Manager</h1>
      <p class="lead">Secure. Offline. Yours.</p>

      <div class="features" aria-hidden="true">
        <div class="chip">AES‑GCM encryption</div>
        <div class="chip">PBKDF2 key derivation</div>
        <div class="chip">Secure RNG (crypto.getRandomValues)</div>
      </div>
      
      <footer>Designed for clarity and trust — keep your master password safe.</footer>
    </section>

    <aside class="card" aria-labelledby="ui-title">
      <h2 id="ui-title" style="margin:0 0 6px 0">Vault</h2>
      <div class="status small" id="status">Locked</div>

      <div id="unlockBlock" style="margin-top:12px">
        <label for="master">Master password</label>
        <input id="master" type="password" placeholder="Enter master password" autocomplete="current-password" />

        <div class="row" style="margin-top:12px">
          <button id="unlockBtn" class="btn">Unlock</button>
          <button id="createBtn" class="btn ghost">Create</button>
        </div>
        <div id="msg" class="small" style="margin-top:10px;color:#b91c1c"></div>
      </div>

      <div id="vault" style="display:none;margin-top:12px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="small">Vault unlocked — entries are stored encrypted in your browser.</div>
          <div>
            <button id="lockBtn" class="btn-sm">Lock</button>
          </div>
        </div>

        <label for="site">Website / App</label>
        <input id="site" type="text" placeholder="example.com" />

        <label for="user">Username</label>
        <input id="user" type="text" placeholder="you@example.com" />

        <label for="pass">Password</label>
        <input id="pass" type="text" placeholder="leave empty to auto-generate" autocomplete="new-password" />

        <div class="row">
          <button id="saveBtn" class="btn">Save</button>
          <button id="genBtn" class="btn ghost">Generate</button>
        </div>

        <h3 style="margin-top:14px;margin-bottom:8px">Saved</h3>
        <div id="list" class="list" aria-live="polite"></div>
      </div>

    </aside>
  </div>

  <script>
  /* Simple visually-oriented encrypted vault
     - PBKDF2 (200k) + AES-GCM
     - Secure RNG via crypto.getRandomValues
     - LocalStorage holds a single JSON record: { salt, iv, data }
     - Session key is only held in memory while unlocked
  */

  const STORAGE_KEY = 'pm_vault_simple_v1';
  const PBKDF2_ITER = 200000;
  const enc = new TextEncoder();
  const dec = new TextDecoder();

  let sessionKey = null;
  let vaultSalt = null;
  let entries = [];

  // Utilities
  function bufToB64(buf){ return btoa(String.fromCharCode(...new Uint8Array(buf))); }
  function b64ToBuf(b64){ const s = atob(b64); const a = new Uint8Array(s.length); for (let i=0;i<s.length;i++) a[i]=s.charCodeAt(i); return a.buffer; }
  function randBytes(n){ const a = new Uint8Array(n); crypto.getRandomValues(a); return a; }

  async function deriveKey(password, salt){
    const base = await crypto.subtle.importKey('raw', enc.encode(password), 'PBKDF2', false, ['deriveKey']);
    const key = await crypto.subtle.deriveKey(
      { name: 'PBKDF2', salt, iterations: PBKDF2_ITER, hash: 'SHA-256' },
      base,
      { name: 'AES-GCM', length: 256 },
      false,
      ['encrypt','decrypt']
    );
    return key;
  }

  async function encryptEntries(obj, key){
    const iv = randBytes(12);
    const plain = enc.encode(JSON.stringify(obj));
    const ct = await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, key, plain);
    return { iv: bufToB64(iv.buffer), data: bufToB64(ct) };
  }

  async function decryptEntries(b64data, b64iv, key){
    const iv = new Uint8Array(b64ToBuf(b64iv));
    const cipher = b64ToBuf(b64data);
    const pt = await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, cipher);
    return JSON.parse(dec.decode(pt));
  }

  function loadStore(){ const s = localStorage.getItem(STORAGE_KEY); return s ? JSON.parse(s) : null; }
  function saveStore(obj){ localStorage.setItem(STORAGE_KEY, JSON.stringify(obj)); }

  // UI references
  const statusEl = document.getElementById('status');
  const unlockBtn = document.getElementById('unlockBtn');
  const createBtn = document.getElementById('createBtn');
  const lockBtn = document.getElementById('lockBtn');
  const saveBtn = document.getElementById('saveBtn');
  const genBtn = document.getElementById('genBtn');
  const msgEl = document.getElementById('msg');

  unlockBtn.addEventListener('click', unlock);
  createBtn.addEventListener('click', createVault);
  lockBtn.addEventListener('click', lock);
  saveBtn.addEventListener('click', saveEntry);
  genBtn.addEventListener('click', ()=>{ document.getElementById('pass').value = generatePassword(16); });

  async function unlock(){
    const pw = document.getElementById('master').value;
    const store = loadStore();
    if (!store){ setMsg('No vault found. Click Create to initialize.'); return; }
    try {
      vaultSalt = new Uint8Array(b64ToBuf(store.salt));
      sessionKey = await deriveKey(pw, vaultSalt);
      entries = await decryptEntries(store.data, store.iv, sessionKey);
      showVault();
      document.getElementById('master').value = '';
      setMsg('');
    } catch (e) {
      console.error(e);
      setMsg('Wrong password or corrupted vault.');
      sessionKey = null; vaultSalt = null;
    }
  }

  async function createVault(){
    const pw = document.getElementById('master').value;
    if (!pw || pw.length < 6){ setMsg('Choose a master password (min 6 chars).'); return; }
    vaultSalt = randBytes(16);
    sessionKey = await deriveKey(pw, vaultSalt);
    entries = [];
    const encObj = await encryptEntries(entries, sessionKey);
    saveStore({ salt: bufToB64(vaultSalt.buffer), iv: encObj.iv, data: encObj.data });
    showVault();
    document.getElementById('master').value = '';
    setMsg('');
  }

  function lock(){
    sessionKey = null; vaultSalt = null; entries = [];
    document.getElementById('vault').style.display = 'none';
    document.getElementById('unlockBlock').style.display = 'block';
    statusEl.textContent = 'Locked';
  }

  async function saveEntry(){
    if (!sessionKey) return setMsg('Vault not unlocked.');
    const site = document.getElementById('site').value.trim();
    const user = document.getElementById('user').value.trim();
    let pass = document.getElementById('pass').value;
    if (!site || !user) return setMsg('Site and username required.');
    if (!pass) pass = generatePassword(16);
    entries.push({ site, user, pass, created: new Date().toISOString() });
    await persist();
    document.getElementById('site').value=''; document.getElementById('user').value=''; document.getElementById('pass').value='';
    renderList();
    setMsg('Saved.');
  }

  async function persist(){
    const encObj = await encryptEntries(entries, sessionKey);
    saveStore({ salt: bufToB64(vaultSalt.buffer), iv: encObj.iv, data: encObj.data });
  }

  function showVault(){
    document.getElementById('unlockBlock').style.display = 'none';
    document.getElementById('vault').style.display = 'block';
    statusEl.textContent = 'Unlocked';
    renderList();
  }

  function renderList(){
    const list = document.getElementById('list');
    list.innerHTML = '';
    if (!entries.length){ list.innerHTML = '<div class="small" style="color:#718096">No entries yet.</div>'; return; }
    entries.forEach((e,i) => {
      const div = document.createElement('div');
      div.className = 'entry';
      div.innerHTML = `
        <b>${escapeHtml(e.site)}</b>
        <div class="small">User: ${escapeHtml(e.user)}</div>
        <div style="margin-top:8px">Password: <code>${escapeHtml(e.pass)}</code></div>
        <div class="meta" style="margin-top:8px">
          <button class="btn-sm" data-action="copy" data-i="${i}">Copy</button>
          <button class="btn-sm" data-action="del" data-i="${i}" style="background:#fee2e2;color:#991b1b">Delete</button>
        </div>
      `;
      list.appendChild(div);
    });
    list.querySelectorAll('button').forEach(btn => {
      btn.addEventListener('click', async (ev) => {
        const action = btn.dataset.action;
        const idx = Number(btn.dataset.i);
        if (action === 'copy') { await copyToClipboard(entries[idx].pass); }
        if (action === 'del') { if (confirm('Delete this entry?')){ entries.splice(idx,1); await persist(); renderList(); } }
      });
    });
  }

  async function copyToClipboard(text){
    try {
      await navigator.clipboard.writeText(text);
      alert('Copied to clipboard. Clear it when done.');
    } catch (e) {
      alert('Failed to copy: ' + e);
    }
  }

  function generatePassword(len=14){
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()-_=+[]{};:,.<>?';
    const bytes = randBytes(len);
    let out = '';
    for (let i=0;i<bytes.length;i++) out += chars[bytes[i] % chars.length];
    return out;
  }

  function setMsg(s){ msgEl.textContent = s || ''; if (!s) msgEl.style.display='none'; else msgEl.style.display='block'; }

  function escapeHtml(s){ if (!s) return ''; return s.replace(/[&<>"'`=\/]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#x2F;','=':'&#x3D;','`':'&#x60;'}[c])); }

  // Init: show unlock
  (function init(){ document.getElementById('vault').style.display = 'none'; setMsg(''); })();
  </script>
</body>
</html>